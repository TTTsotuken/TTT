<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>翻訳チャットアプリ</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app">
        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md text-center">
                <div class="text-6xl mb-4">⏳</div>
                <p class="text-lg font-medium text-gray-700">読み込み中...</p>
            </div>
        </div>
    </div>
    
    <!-- 設定を最初に読み込む -->
    <script src="./js/config.js"></script>
    
    <!-- Firebase Serviceをインラインで読み込む -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, set, update, remove, onValue, off, serverTimestamp, push } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';

class FirebaseService {
  constructor() {
    this.app = null;
    this.database = null;
    this.initialized = false;
    this._serverTimestamp = serverTimestamp;
  }

  async initialize() {
    if (this.initialized) return;
    
    try {
      this.app = initializeApp(CONFIG.firebase);
      this.database = getDatabase(this.app);
      this.initialized = true;
      console.log('✅ Firebase初期化完了');
    } catch (error) {
      console.error('❌ Firebase初期化エラー:', error);
      throw error;
    }
  }

  ref(path) {
    return ref(this.database, path);
  }

  async get(path) {
    const snapshot = await get(this.ref(path));
    return snapshot.val();
  }

  async set(path, data) {
    await set(this.ref(path), data);
  }

  async update(path, data) {
    await update(this.ref(path), data);
  }

  async remove(path) {
    await remove(this.ref(path));
  }

  onValue(path, callback) {
    return onValue(this.ref(path), callback);
  }

  off(path, callback) {
    off(this.ref(path), callback);
  }

  get serverTimestamp() {
    return this._serverTimestamp();
  }

  push(path) {
    return push(this.ref(path));
  }
}

        window.firebaseService = new FirebaseService();
        console.log('✅ Firebase Serviceセット完了');
    </script>
    
    <!-- 他のサービスを読み込む -->
    <script src="./js/gemini-service.js"></script>
    <script src="./js/auth-service.js"></script>
    <script src="./js/chat-service.js"></script>
    
    <!-- 最後にアプリを読み込む -->
    <script>
        // 全サービスが読み込まれたことを確認
        window.addEventListener('load', () => {
            console.log('Services check:', {
                firebase: !!window.firebaseService,
                gemini: !!window.geminiService,
                auth: !!window.authService,
                chat: !!window.chatService
            });
            
            // Firebase Service準備完了を通知
            window.firebaseServiceReady = true;
            window.dispatchEvent(new Event('firebaseServiceReady'));
        });
    </script>
    <script src="./js/app.js"></script>
</body>
</html>
