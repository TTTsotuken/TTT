<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç¿»è¨³ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50">
    <div id="app">
        <div class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4">
            <div class="bg-white rounded-2xl shadow-xl p-8 w-full max-w-md text-center">
                <div class="text-6xl mb-4">â³</div>
                <p class="text-lg font-medium text-gray-700">èª­ã¿è¾¼ã¿ä¸­...</p>
            </div>
        </div>
    </div>
    
    <script src="./js/config.js"></script>
    <script src="./js/config-gemini.js"></script>
    
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, get, set, update, remove, onValue, off, serverTimestamp, push } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        // ğŸš¨ ãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆï¼ˆgetAuth, signInWithEmailAndPasswordãªã©ï¼‰ã¯å‰Šé™¤æ¸ˆã¿

        // FirebaseåˆæœŸåŒ–
        const app = initializeApp(CONFIG.firebase);
        const database = getDatabase(app);
        // ğŸš¨ const auth = getAuth(app); ã¯å‰Šé™¤æ¸ˆã¿

        class FirebaseService {
            constructor() {
                this.app = app;
                this.database = database;
                this.initialized = true;
            }

            ref(path) {
                return ref(this.database, path);
            }

            async get(path) {
                const snapshot = await get(this.ref(path));
                return snapshot.val();
            }

            async set(path, data) {
                await set(this.ref(path), data);
            }

            async update(path, data) {
                await update(this.ref(path), data);
            }

            async remove(path) {
                await remove(this.ref(path));
            }

            onValue(path, callback) {
                return onValue(this.ref(path), callback);
            }

            off(path, callback) {
                off(this.ref(path), callback);
            }

            getServerTimestamp() {
                return serverTimestamp();
            }

            push(path) {
                return push(this.ref(path));
            }
        }

        window.firebaseService = new FirebaseService();
        console.log('âœ… Firebase Service ã‚»ãƒƒãƒˆå®Œäº†');

        // ğŸ”¥ èªè¨¼æ©Ÿèƒ½ã‚’å‰Šé™¤ã—ãŸãŸã‚ã€ãƒ€ãƒŸãƒ¼ã‚µãƒ¼ãƒ“ã‚¹ã‚’å®šç¾© (ã‚¨ãƒ©ãƒ¼é˜²æ­¢)
        class AdminAuthService {
            constructor() {
                console.log('âœ… Admin Auth Service ãƒ€ãƒŸãƒ¼åˆæœŸåŒ–å®Œäº† (èªè¨¼æ©Ÿèƒ½å‰Šé™¤æ¸ˆã¿)');
            }
            // å¸¸ã«ãƒ­ã‚°ã‚¤ãƒ³æ¸ˆã¿ã¨ã—ã¦æ‰±ã†
            isLoggedIn() { return true; } 
            // ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã¯æˆåŠŸã‚’è¿”ã™
            async login(email, password) { 
                console.log('èªè¨¼æ©Ÿèƒ½ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ­ã‚°ã‚¤ãƒ³å‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
                return { success: true, user: { uid: 'guest-user', email: 'guest@example.com' } }; 
            }
            // ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ã¯æˆåŠŸã‚’è¿”ã™
            async logout() { 
                console.log('èªè¨¼æ©Ÿèƒ½ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ãƒ­ã‚°ã‚¢ã‚¦ãƒˆå‡¦ç†ã‚’ã‚¹ã‚­ãƒƒãƒ—ã—ã¾ã—ãŸ');
                return { success: true }; 
            }
            
            // æ‹›å¾…ãƒˆãƒ¼ã‚¯ãƒ³é–¢é€£ã¯ãã®ã¾ã¾æ®‹ã™ã‹ã€å¿…è¦ã«å¿œã˜ã¦ãƒ€ãƒŸãƒ¼åŒ–
            generateInviteToken(roomId, password) {
                const data = `${roomId}:${password}:${Date.now()}`;
                return btoa(data);
            }

            validateInviteToken(token) {
                try {
                    const decoded = atob(token);
                    const parts = decoded.split(':');
                    if (parts.length === 3) {
                        return {
                            valid: true,
                            roomId: parts[0],
                            password: parts[1],
                            timestamp: parseInt(parts[2])
                        };
                    }
                } catch (e) {
                    console.error('ãƒˆãƒ¼ã‚¯ãƒ³æ¤œè¨¼ã‚¨ãƒ©ãƒ¼:', e);
                }
                return { valid: false };
            }
        }

        window.adminAuthService = new AdminAuthService();
        // ğŸš¨ ãƒ­ã‚°å‡ºåŠ›ã‚‚ä¿®æ­£
    </script>
    
    <script src="./js/gemini-service.js"></script>
    
    <script src="./js/auth-service.js"></script>
    <script src="./js/chat-service.js"></script>
    
    <script>
        // å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒèª­ã¿è¾¼ã¾ã‚ŒãŸã“ã¨ã‚’ç¢ºèª
        window.addEventListener('load', () => {
            console.log('Services check:', {
                firebase: !!window.firebaseService,
                translation: !!window.translationService,
                auth: !!window.authService,
                chat: !!window.chatService,
                adminAuth: !!window.adminAuthService // ğŸ”¥ è¿½åŠ 
            });
            
            // Firebase Serviceæº–å‚™å®Œäº†ã‚’é€šçŸ¥
            window.firebaseServiceReady = true;
            window.dispatchEvent(new Event('firebaseServiceReady'));
        });
    </script>
    <script src="./js/app.js"></script>
</body>
</html>